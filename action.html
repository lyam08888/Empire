<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire - Prototype de Jeu Avanc√©</title>
    <meta name="description" content="Prototype d'interface complet pour le jeu de strat√©gie Empire, bas√© sur un cahier des charges d√©taill√©.">
    <meta name="author" content="Empire Game Studio">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%231e3a8a'/><text x='16' y='20' text-anchor='middle' fill='white' font-family='Arial' font-size='18' font-weight='bold'>E</text></svg>" type="image/svg+xml">

    <style>
        :root {
            --color-primary: #fbbf24; /* Or */
            --color-secondary: #3b82f6; /* Bleu */
            --color-dark-1: #0a192f; /* Fond principal */
            --color-dark-2: #1e3a8a; /* D√©grad√© fond */
            --color-panel: rgba(15, 23, 42, 0.8); /* Panneaux */
            --color-panel-light: rgba(30, 41, 59, 0.8);
            --color-text: #e2e8f0;
            --color-text-muted: #94a3b8;
            --color-border: rgba(148, 163, 184, 0.2);
        }

        /* Styles de base et reset */
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, var(--color-dark-1), var(--color-dark-2));
            color: var(--color-text);
            height: 100vh;
            overflow: hidden;
        }
        .hidden { display: none !important; }

        /* --- LAYOUT GLOBAL --- */
        .game-ui { display: flex; flex-direction: column; height: 100%; }
        .game-header, .game-footer { flex-shrink: 0; z-index: 100; }
        .game-body { display: flex; flex-grow: 1; overflow: hidden; padding: 1rem; gap: 1rem; }

        /* --- HEADER --- */
        .game-header { padding: 0.5rem 1rem; background: var(--color-panel); backdrop-filter: blur(5px); border-bottom: 1px solid var(--color-border); }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1600px; margin: 0 auto; }
        .resources { display: flex; flex-wrap: wrap; gap: 1rem; background: var(--color-panel-light); padding: 0.5rem 1rem; border-radius: 0.5rem; }
        .resource-item { display: flex; align-items: center; gap: 0.5rem; font-weight: bold; }
        .resource-item span { color: var(--color-primary); min-width: 50px; }
        .player-info a { color: var(--color-text-muted); text-decoration: none; transition: color 0.3s; }
        .player-info a:hover { color: var(--color-primary); }

        /* --- BARRE DE NAVIGATION GAUCHE --- */
        .left-sidebar { width: 200px; flex-shrink: 0; background: var(--color-panel); padding: 1rem; border-radius: 1rem; overflow-y: auto; }
        .main-nav ul { list-style: none; }
        .main-nav li a { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; margin-bottom: 0.5rem; color: var(--color-text); text-decoration: none; border-radius: 0.5rem; transition: all 0.3s; cursor: pointer; }
        .main-nav li a:hover, .main-nav li a.active { background: rgba(251, 191, 36, 0.1); color: var(--color-primary); transform: translateX(5px); }

        /* --- VUE CENTRALE (Conteneur) --- */
        .main-view-container { flex-grow: 1; position: relative; }
        .main-view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/dark-matter.png'), linear-gradient(135deg, #1c2a4b, #111827);
            border-radius: 1rem;
            overflow: auto;
            padding: 1.5rem;
        }
        .main-view h2 { color: var(--color-primary); margin-bottom: 1rem; font-size: 1.8rem; }
        
        /* --- VUE VILLE --- */
        .city-view-content { position: relative; width: 100%; height: 100%; }
        .building-plot {
            position: absolute; background: rgba(30, 64, 175, 0.3); border: 2px dashed rgba(59, 130, 246, 0.5);
            border-radius: 0.5rem; cursor: pointer; transition: all 0.3s; display: flex; justify-content: center;
            align-items: center; font-size: 2rem; color: rgba(255, 255, 255, 0.5);
        }
        .building-plot:hover, .building-plot.selected { background: rgba(251, 191, 36, 0.3); border-color: var(--color-primary); }
        .building-plot.constructing::after { content: '‚è≥'; position: absolute; top: 5px; right: 5px; font-size: 1rem; }
        .building-plot .level { position: absolute; bottom: 2px; right: 5px; font-size: 0.8rem; font-weight: bold; color: white; background: rgba(0,0,0,0.5); padding: 0 4px; border-radius: 3px; }

        /* --- VUE √éLE & MONDE --- */
        .map-grid { display: grid; gap: 1rem; }
        .island-view-content { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
        .map-tile { background: var(--color-panel-light); border: 1px solid var(--color-border); border-radius: 0.5rem; padding: 1rem; text-align: center; cursor: pointer; transition: all 0.3s; }
        .map-tile:hover { border-color: var(--color-primary); transform: translateY(-5px); }
        .map-tile h4 { color: var(--color-primary); }
        .map-tile p { color: var(--color-text-muted); font-size: 0.9rem; }

        /* --- VUE RECHERCHE & MILITAIRE --- */
        .management-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; }
        .card { background: var(--color-panel-light); border: 1px solid var(--color-border); border-radius: 0.5rem; padding: 1rem; }
        .card h4 { color: var(--color-primary); margin-bottom: 0.5rem; }
        .card p { color: var(--color-text-muted); font-size: 0.9rem; margin-bottom: 1rem; }
        .card .cost { font-size: 0.8rem; margin-bottom: 1rem; }
        .action-btn { width: 100%; background: var(--color-primary); color: var(--color-dark-1); border: none; padding: 0.75rem; border-radius: 0.5rem; font-weight: bold; font-size: 1rem; cursor: pointer; transition: all 0.3s; }
        .action-btn:hover { transform: scale(1.05); }
        .action-btn:disabled { background: #6b7280; cursor: not-allowed; transform: none; }

        /* --- PANNEAU CONTEXTUEL DROIT --- */
        .right-sidebar { width: 280px; flex-shrink: 0; background: var(--color-panel); padding: 1rem; border-radius: 1rem; display: flex; flex-direction: column; }
        .context-panel h3 { color: var(--color-primary); border-bottom: 1px solid var(--color-border); padding-bottom: 0.5rem; margin-bottom: 1rem; }
        #context-content p { color: var(--color-text-muted); line-height: 1.5; }
        .build-queue-list { list-style: none; margin-top: auto; padding-top: 1rem; }
        .queue-item { background: var(--color-panel-light); padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.5rem; }
        .queue-item .name { font-weight: bold; }
        .queue-item .timer { color: var(--color-primary); }

        /* --- FOOTER --- */
        .game-footer { padding: 0.5rem 1rem; background: var(--color-panel); border-top: 1px solid var(--color-border); }
        .footer-content { max-width: 1600px; margin: 0 auto; color: var(--color-text-muted); text-align: center; }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 1000; animation: fadeIn 0.3s; }
        .modal-content { background: var(--color-dark-1); border: 1px solid var(--color-primary); padding: 2rem; border-radius: 1rem; text-align: center; width: 90%; max-width: 400px; }
        .modal-content h4 { font-size: 1.5rem; color: var(--color-primary); margin-bottom: 1rem; }
        #modal-cost { color: var(--color-text-muted); margin-bottom: 1rem; }
        .modal-actions { display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem; }
        .modal-btn { border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-weight: bold; transition: opacity 0.3s; }
        .modal-btn.confirm { background: var(--color-primary); color: var(--color-dark-1); }
        .modal-btn.cancel { background: var(--color-panel-light); color: var(--color-text); }
        .modal-btn:hover { opacity: 0.8; }
    </style>
</head>
<body>
    <div class="game-ui">
        <!-- HEADER -->
        <header class="game-header">
            <div class="header-content">
                <div class="player-info"><a href="#">Joueur_01</a></div>
                <div class="resources">
                    <div class="resource-item" title="Bois">üå≤ <span id="resWood">0</span></div>
                    <div class="resource-item" title="Vin">üçá <span id="resWine">0</span></div>
                    <div class="resource-item" title="Marbre">üèõÔ∏è <span id="resMarble">0</span></div>
                    <div class="resource-item" title="Cristal">üíé <span id="resCrystal">0</span></div>
                    <div class="resource-item" title="Soufre">üî• <span id="resSulfur">0</span></div>
                    <div class="resource-item" title="Or">üí∞ <span id="resGold">0</span></div>
                    <div class="resource-item" title="Points de Recherche">üî¨ <span id="resResearch">0</span></div>
                </div>
                <div class="player-info"><a href="#">D√©connexion</a></div>
            </div>
        </header>

        <!-- CORPS PRINCIPAL -->
        <main class="game-body">
            <!-- MENU GAUCHE -->
            <nav class="left-sidebar">
                <div class="main-nav">
                    <ul>
                        <li><a data-view="city">üèõÔ∏è <span>Ville</span></a></li>
                        <li><a data-view="island">üèùÔ∏è <span>√éle</span></a></li>
                        <li><a data-view="world">üåç <span>Monde</span></a></li>
                        <li><a data-view="research">üî¨ <span>Recherche</span></a></li>
                        <li><a data-view="military">‚öîÔ∏è <span>Militaire</span></a></li>
                        <li><a data-view="diplomacy">ü§ù <span>Diplomatie</span></a></li>
                    </ul>
                </div>
            </nav>

            <!-- VUE CENTRALE (Conteneur pour toutes les vues) -->
            <div class="main-view-container">
                <section id="view-city" class="main-view"><div class="city-view-content" id="city-grid"></div></section>
                <section id="view-island" class="main-view hidden"><h2>Vue de l'√éle</h2><div class="map-grid island-view-content"><div class="map-tile"><h4>Scierie (Commun)</h4><p>Niveau 5</p></div><div class="map-tile"><h4>Mine de Marbre</h4><p>Niveau 3</p></div><div class="map-tile"><h4>Ville de Joueur_02</h4><p>Points: 1,250</p></div><div class="map-tile"><h4>Votre Ville</h4><p>Points: 800</p></div></div></section>
                <section id="view-world" class="main-view hidden"><h2>Carte du Monde</h2></section>
                <section id="view-research" class="main-view hidden"><h2>Recherche</h2><div id="research-grid" class="management-grid"></div></section>
                <section id="view-military" class="main-view hidden"><h2>Militaire</h2><div id="military-grid" class="management-grid"></div></section>
                <section id="view-diplomacy" class="main-view hidden"><h2>Diplomatie</h2><p>Interface de diplomatie √† venir...</p></section>
            </div>
            
            <!-- PANNEAU DROIT -->
            <aside class="right-sidebar">
                <div id="context-panel"><h3>Informations</h3><div id="context-content"><p>S√©lectionnez un √©l√©ment.</p></div></div>
                <div class="build-queue-list"><h3>Files d'attente</h3><ul id="queueList"></ul></div>
            </aside>
        </main>

        <!-- FOOTER -->
        <footer class="game-footer"><div class="footer-content" id="event-log">Bienvenue dans Empire !</div></footer>
    </div>
    
    <!-- MODAL -->
    <div class="modal-overlay" id="actionModal">
        <div class="modal-content">
            <h4 id="modalTitle"></h4><p id="modalMessage"></p><div id="modal-cost"></div>
            <div class="modal-actions">
                <button class="modal-btn cancel" id="modalCancelBtn">Annuler</button>
                <button class="modal-btn confirm" id="modalConfirmBtn">Confirmer</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CONFIGURATION DU JEU ---
            const config = {
                buildings: {
                    "H√¥tel de Ville": { description: "Augmente la population et le revenu en or.", icon: "üèõÔ∏è", levels: [ { cost: { wood: 150 }, buildTime: 10 }, { cost: { wood: 350 }, buildTime: 25 } ] },
                    "Caserne": { description: "Permet de recruter des unit√©s.", icon: "‚öîÔ∏è", levels: [ { cost: { wood: 200, gold: 50 }, buildTime: 15 }, { cost: { wood: 450, gold: 120 }, buildTime: 35 } ] },
                    "Entrep√¥t": { description: "Augmente le stockage.", icon: "üß±", levels: [ { cost: { wood: 250 }, buildTime: 12 }, { cost: { wood: 500 }, buildTime: 30 } ] },
                    "Acad√©mie": { description: "Produit des points de recherche.", icon: "üî¨", levels: [ { cost: { wood: 300, crystal: 100 }, buildTime: 20 }, { cost: { wood: 600, crystal: 250 }, buildTime: 45 } ] }
                },
                research: {
                    economy: { name: "√âconomie", icon: "üí∞", techs: { "Expansion": { description: "Permet de fonder une nouvelle colonie.", cost: { research: 500 }, time: 60 } } },
                    military: { name: "Militaire", icon: "‚öîÔ∏è", techs: { "Balistique": { description: "Am√©liore la pr√©cision des catapultes.", cost: { research: 300 }, time: 45 } } }
                },
                units: {
                    "Hoplite": { description: "Unit√© de base solide.", icon: "üõ°Ô∏è", cost: { wood: 50, sulfur: 30, gold: 10 }, time: 5 },
                    "Archer": { description: "Attaque √† distance.", icon: "üèπ", cost: { wood: 40, gold: 15 }, time: 4 }
                },
                cityLayout: [
                    { id: "townHall", top: "40%", left: "45%", width: "120px", height: "120px" },
                    { id: "plot1", top: "35%", left: "25%", width: "90px", height: "90px" },
                    { id: "plot2", top: "55%", left: "30%", width: "90px", height: "90px" },
                    { id: "plot3", top: "50%", left: "60%", width: "90px", height: "90px" },
                    { id: "academy", top: "20%", left: "60%", width: "90px", height: "90px" }
                ]
            };

            // --- √âTAT DU JEU ---
            let gameState = {
                resources: { wood: 1000, wine: 100, marble: 100, crystal: 100, sulfur: 100, gold: 5000, research: 0 },
                buildings: { "townHall": { type: "H√¥tel de Ville", level: 1 }, "plot1": { type: "Caserne", level: 1 }, "plot2": { type: null, level: 0 }, "plot3": { type: null, level: 0 }, "academy": { type: "Acad√©mie", level: 1 } },
                researchCompleted: [],
                queues: { build: [], research: [], military: [] }
            };

            // --- DOM ELEMENTS ---
            const dom = {
                res: Object.keys(gameState.resources).reduce((acc, key) => ({ ...acc, [key]: document.getElementById(`res${key.charAt(0).toUpperCase() + key.slice(1)}`) }), {}),
                cityGrid: document.getElementById('city-grid'),
                contextContent: document.getElementById('context-content'),
                queueList: document.getElementById('queueList'),
                eventLog: document.getElementById('event-log'),
                modal: document.getElementById('actionModal'),
                modalTitle: document.getElementById('modalTitle'),
                modalMessage: document.getElementById('modalMessage'),
                modalCost: document.getElementById('modal-cost'),
                modalConfirmBtn: document.getElementById('modalConfirmBtn'),
                modalCancelBtn: document.getElementById('modalCancelBtn'),
                navLinks: document.querySelectorAll('.main-nav a'),
                mainViews: document.querySelectorAll('.main-view'),
                researchGrid: document.getElementById('research-grid'),
                militaryGrid: document.getElementById('military-grid'),
            };

            let selectedPlotId = null;
            let currentAction = null;

            // --- NAVIGATION & VUES ---
            function switchView(viewId) {
                dom.mainViews.forEach(view => view.classList.add('hidden'));
                document.getElementById(`view-${viewId}`).classList.remove('hidden');
                dom.navLinks.forEach(link => link.classList.toggle('active', link.dataset.view === viewId));
                updateContextPanel(); // Reset context panel
            }

            // --- LOGIQUE DE JEU PRINCIPALE ---
            function init() {
                renderCityLayout();
                renderResearchTree();
                renderMilitaryUnits();
                updateAllUI();
                switchView('city');
                setInterval(gameLoop, 1000);
                dom.navLinks.forEach(link => link.addEventListener('click', (e) => switchView(link.dataset.view)));
            }

            function gameLoop() {
                // Production de ressources
                const townHallLevel = gameState.buildings.townHall.level;
                gameState.resources.gold += townHallLevel * 2 / 3600; // Or par seconde
                gameState.resources.wood += 5 / 3600; // Bois de base
                const academyLevel = gameState.buildings.academy?.level || 0;
                if (academyLevel > 0) gameState.resources.research += academyLevel * 2 / 3600;

                processQueues();
                updateAllUI();
            }

            function processQueues() {
                const now = Date.now();
                let stateChanged = false;
                ['build', 'research', 'military'].forEach(qType => {
                    const finished = [];
                    gameState.queues[qType].forEach((item, index) => {
                        if (now >= item.endTime) {
                            finished.push(index);
                            logEvent(`${item.name} termin√©.`);
                            if (qType === 'build') {
                                if (item.level === 1) gameState.buildings[item.id].type = item.name;
                                gameState.buildings[item.id].level = item.level;
                            } else if (qType === 'research') {
                                gameState.researchCompleted.push(item.name);
                            }
                        }
                    });
                    if (finished.length > 0) {
                        gameState.queues[qType] = gameState.queues[qType].filter((_, index) => !finished.includes(index));
                        stateChanged = true;
                    }
                });
                if (stateChanged) {
                    renderCityLayout();
                    renderResearchTree();
                    renderMilitaryUnits();
                    if (selectedPlotId) updateContextPanel(selectedPlotId);
                }
            }
            
            function startAction(type, id, name, level) {
                const queue = gameState.queues[type];
                let spec, cost, time;

                if (type === 'build') {
                    spec = config.buildings[name].levels[level - 1];
                    cost = spec.cost;
                    time = spec.buildTime;
                } else if (type === 'research') {
                    const branch = Object.keys(config.research).find(br => config.research[br].techs[name]);
                    spec = config.research[branch].techs[name];
                    cost = spec.cost;
                    time = spec.time;
                } else if (type === 'military') {
                    spec = config.units[name];
                    cost = spec.cost;
                    time = spec.time;
                }
                
                for(const res in cost) {
                    if (gameState.resources[res] < cost[res]) {
                        showModal("Action impossible", "Ressources insuffisantes.");
                        return;
                    }
                }
                for(const res in cost) gameState.resources[res] -= cost[res];

                const endTime = Date.now() + time * 1000;
                queue.push({ id, name, level, endTime });
                logEvent(`Lancement: ${name}.`);
                updateAllUI();
                if (selectedPlotId) updateContextPanel(selectedPlotId);
            }

            // --- FONCTIONS D'AFFICHAGE ---
            function updateAllUI() {
                updateResourceUI();
                updateQueueUI();
            }

            function updateResourceUI() {
                for (const res in dom.res) {
                    if(dom.res[res]) dom.res[res].textContent = Math.floor(gameState.resources[res]);
                }
            }

            function renderCityLayout() {
                dom.cityGrid.innerHTML = '';
                config.cityLayout.forEach(plot => {
                    const el = document.createElement('div');
                    el.className = 'building-plot';
                    el.dataset.plotId = plot.id;
                    el.style.cssText = `top:${plot.top}; left:${plot.left}; width:${plot.width}; height:${plot.height};`;
                    const building = gameState.buildings[plot.id];
                    if (building && building.type) {
                        el.innerHTML = `${config.buildings[building.type].icon}<div class="level">Niv. ${building.level}</div>`;
                    } else {
                        el.innerHTML = '‚ûï';
                    }
                    if (gameState.queues.build.some(item => item.id === plot.id)) el.classList.add('constructing');
                    el.addEventListener('click', () => {
                        selectedPlotId = plot.id;
                        document.querySelectorAll('.building-plot.selected').forEach(p => p.classList.remove('selected'));
                        el.classList.add('selected');
                        updateContextPanel(plot.id);
                    });
                    dom.cityGrid.appendChild(el);
                });
            }

            function updateContextPanel(plotId) {
                if (!plotId) {
                    dom.contextContent.innerHTML = '<p>S√©lectionnez un √©l√©ment pour voir ses d√©tails.</p>';
                    return;
                }
                const building = gameState.buildings[plotId];
                let html = '';
                if (building && building.type) {
                    const { type, level } = building;
                    const spec = config.buildings[type];
                    const nextLevel = level < spec.levels.length ? level + 1 : null;
                    html = `<h3>${type} (Niv ${level})</h3><p>${spec.description}</p>`;
                    if (gameState.queues.build.some(item => item.id === plotId)) {
                        html += `<p style="color: var(--color-primary); margin-top: 1rem;">Am√©lioration en cours...</p>`;
                    } else if (nextLevel) {
                        html += `<button class="action-btn" data-action="build" data-id="${plotId}" data-name="${type}" data-level="${nextLevel}">Am√©liorer</button>`;
                    } else {
                        html += `<p style="color: var(--color-primary); margin-top: 1rem;">Niveau maximum</p>`;
                    }
                } else {
                    html = `<h3>Emplacement Vide</h3><p>Cliquez pour construire :</p><div>`;
                    for (const type in config.buildings) {
                        html += `<button class="action-btn" data-action="build" data-id="${plotId}" data-name="${type}" data-level="1">${config.buildings[type].icon} ${type}</button>`;
                    }
                    html += `</div>`;
                }
                dom.contextContent.innerHTML = html;
            }

            function renderResearchTree() {
                let html = '';
                for (const branchKey in config.research) {
                    const branch = config.research[branchKey];
                    html += `<div><h3>${branch.name}</h3>`;
                    for (const techKey in branch.techs) {
                        const tech = branch.techs[techKey];
                        const isCompleted = gameState.researchCompleted.includes(techKey);
                        const isResearching = gameState.queues.research.some(t => t.name === techKey);
                        html += `<div class="card"><h4>${techKey}</h4><p>${tech.description}</p><p class="cost">Co√ªt: üî¨${tech.cost.research}</p>`;
                        if (isCompleted) {
                            html += `<button class="action-btn" disabled>Termin√©</button>`;
                        } else if (isResearching) {
                            html += `<button class="action-btn" disabled>En cours...</button>`;
                        } else {
                            html += `<button class="action-btn" data-action="research" data-name="${techKey}" data-level="1">Rechercher</button>`;
                        }
                        html += `</div>`;
                    }
                    html += `</div>`;
                }
                dom.researchGrid.innerHTML = html;
            }

            function renderMilitaryUnits() {
                let html = '';
                for (const unitKey in config.units) {
                    const unit = config.units[unitKey];
                    const isRecruiting = gameState.queues.military.some(u => u.name === unitKey);
                    html += `<div class="card"><h4>${unitKey} ${unit.icon}</h4><p>${unit.description}</p><p class="cost">Co√ªt: üå≤${unit.cost.wood || 0} üî•${unit.cost.sulfur || 0} üí∞${unit.cost.gold || 0}</p>`;
                    if (isRecruiting) {
                        html += `<button class="action-btn" disabled>En formation...</button>`;
                    } else {
                        html += `<button class="action-btn" data-action="military" data-name="${unitKey}" data-level="1">Recruter</button>`;
                    }
                    html += `</div>`;
                }
                dom.militaryGrid.innerHTML = html;
            }
            
            function updateQueueUI() {
                dom.queueList.innerHTML = '';
                ['build', 'research', 'military'].forEach(qType => {
                    gameState.queues[qType].forEach(item => {
                        const remainingTime = Math.max(0, Math.ceil((item.endTime - Date.now()) / 1000));
                        const li = document.createElement('li');
                        li.className = 'queue-item';
                        li.innerHTML = `<div class="name">${item.name} ${item.level ? `(Niv. ${item.level})` : ''}</div><div class="timer">${new Date(remainingTime * 1000).toISOString().substr(14, 5)}</div>`;
                        dom.queueList.appendChild(li);
                    });
                });
            }
            
            function showModal(action, id, name, level) {
                let spec, cost, time, title, message;
                if (action === 'build') {
                    spec = config.buildings[name].levels[level - 1];
                    title = `${level > 1 ? 'Am√©liorer' : 'Construire'} ${name}`;
                    message = `Voulez-vous vraiment lancer cette action ?`;
                    cost = spec.cost;
                    time = spec.buildTime;
                } else if (action === 'research') {
                    const branch = Object.keys(config.research).find(br => config.research[br].techs[name]);
                    spec = config.research[branch].techs[name];
                    title = `Rechercher ${name}`;
                    message = `Lancer la recherche ?`;
                    cost = spec.cost;
                    time = spec.time;
                } else if (action === 'military') {
                    spec = config.units[name];
                    title = `Recruter ${name}`;
                    message = `Lancer le recrutement ?`;
                    cost = spec.cost;
                    time = spec.time;
                }
                
                currentAction = () => startAction(action, id, name, level);
                dom.modalTitle.textContent = title;
                dom.modalMessage.textContent = message;
                dom.modalCost.innerHTML = `Co√ªt: ${Object.entries(cost).map(([res, val]) => `${res}: ${val}`).join(', ')} - Temps: ${time}s`;
                dom.modal.style.display = 'flex';
            }

            function logEvent(message) { dom.eventLog.textContent = message; }

            // --- EVENT LISTENERS ---
            document.body.addEventListener('click', e => {
                const target = e.target.closest('button[data-action]');
                if (!target) return;
                const { action, id, name, level } = target.dataset;
                showModal(action, id, name, parseInt(level));
            });
            dom.modalConfirmBtn.addEventListener('click', () => {
                if (currentAction) currentAction();
                dom.modal.style.display = 'none';
                currentAction = null;
            });
            dom.modalCancelBtn.addEventListener('click', () => {
                dom.modal.style.display = 'none';
                currentAction = null;
            });

            // --- INITIALISATION ---
            init();
        });
    </script>
</body>
</html>
